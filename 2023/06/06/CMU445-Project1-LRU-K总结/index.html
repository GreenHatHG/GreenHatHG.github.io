<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CMU445-Project1-LRU-K总结 | GreenHatHGのBlog</title><meta name="author" content="GreenHatHg"><meta name="copyright" content="GreenHatHg"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="https://15445.courses.cs.cmu.edu/fall2022/project1/ DB的Buffer Replacement Policies中的LRU和Clock算法都容易受到sequential..."><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CMU445-Project1-LRU-K总结",
  "url": "https://greenhathg.github.io/2023/06/06/CMU445-Project1-LRU-K%E6%80%BB%E7%BB%93/",
  "image": "https://images.unsplash.com/photo-1619342802099-027bc73e30eb?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1171&q=80",
  "datePublished": "2023-06-06T08:35:43.000Z",
  "dateModified": "2025-06-15T04:30:37.960Z",
  "author": [
    {
      "@type": "Person",
      "name": "GreenHatHg",
      "url": "https://greenhathg.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="https://avatars0.githubusercontent.com/u/34258355?s=460&u=eb0a1ce09dd045532464cb42f020e8ba1d025b6c&v=4"><link rel="canonical" href="https://greenhathg.github.io/2023/06/06/CMU445-Project1-LRU-K%E6%80%BB%E7%BB%93/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="&lt;meta name=&quot;google-site-verification&quot; content=&quot;eCt7WHUdmok7J0DG_5L1LtGFqZ_0DeC0ndMY3tBY_rQ&quot; /&gt;"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-116672888-1"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'UA-116672888-1')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'UA-116672888-1', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CMU445-Project1-LRU-K总结',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://avatars0.githubusercontent.com/u/34258355?s=460&amp;u=eb0a1ce09dd045532464cb42f020e8ba1d025b6c&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">201</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">239</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/mood/"><i class="fa-fw fas fa-glass-cheers"></i><span> 自言自语</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://images.unsplash.com/photo-1619342802099-027bc73e30eb?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1171&amp;q=80);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">GreenHatHGのBlog</span></a><a class="nav-page-title" href="/"><span class="site-name">CMU445-Project1-LRU-K总结</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/mood/"><i class="fa-fw fas fa-glass-cheers"></i><span> 自言自语</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">CMU445-Project1-LRU-K总结</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-06-06T08:35:43.000Z" title="发表于 2023-06-06 08:35:43">2023-06-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-15T04:30:37.960Z" title="更新于 2025-06-15 04:30:37">2025-06-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">1.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>4分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2023/06/06/CMU445-Project1-LRU-K%E6%80%BB%E7%BB%93/#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:500,&quot;messagePrev&quot;:&quot;已超过&quot;,&quot;messageNext&quot;:&quot;天未更新，某些文章具有时效性，若有错误或已失效，请反馈到greenhat2333@gamil.com&quot;,&quot;postUpdate&quot;:&quot;2025-06-15 04:30:37&quot;}" hidden></div><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://15445.courses.cs.cmu.edu/fall2022/project1/">https://15445.courses.cs.cmu.edu/fall2022/project1/</a></p>
<p>DB的Buffer Replacement Policies中的LRU和Clock算法都容易受到<code>sequential flooding</code>的影响，对于LRU来讲，使用LRU-K算法能够缓解这个问题。</p>
<h1 id="LRU-K"><a href="#LRU-K" class="headerlink" title="LRU-K"></a>LRU-K</h1><ul>
<li>This component is responsible for tracking page usage in the buffer pool.</li>
<li>The LRU-K algorithm evicts a frame whose <strong>backward k-distance</strong> is <strong>maximum</strong> of all frames in the replacer.<ul>
<li>Backward k-distance is computed as the <strong>difference in time</strong> between <strong>current timestamp</strong> and the <strong>timestamp of kth previous access</strong>.</li>
<li>A frame with <strong>less than k</strong> historical accesses is given <strong>+inf</strong> as its backward k-distance.</li>
<li>When multipe frames have +inf backward k-distance, the replacer evicts the frame with the <strong>earliest timestamp</strong>.</li>
</ul>
</li>
</ul>
<h1 id="Backward-k-distance"><a href="#Backward-k-distance" class="headerlink" title="Backward k-distance"></a>Backward k-distance</h1><p>这个数据很关键，也很容易被理解错，下面举例说明，当k=3时候</p>
<p><img src="/2023/06/06/CMU445-Project1-LRU-K%E6%80%BB%E7%BB%93/image-20230607080508643.png" alt="image-20230607080508643"></p>
<p>由上面的定义可知，Backward k-distance为current_timestamp和倒数第k次访问的时间之差，故k=3时候如上面所示</p>
<p>因为每次current_timestamp都是一样的，所以其实直接看第k次访问的时间点就好，这里可以不用记下每次访问的时间戳，直接记录访问对应的index就好了，也就说记住某个数在第几次出现就好了。</p>
<h1 id="Evit"><a href="#Evit" class="headerlink" title="Evit"></a>Evit</h1><ul>
<li><p>每次都选择最大的Backward k-distance驱除(evit)，这里存在两种情况:</p>
<ol>
<li><p>某个数已经有了k次访问记录，那么Backward k-distance就是上图所示</p>
</li>
<li><p>如果不够k次访问，那么Backward k-distance就是正无穷大</p>
</li>
</ol>
</li>
<li><p>那么每次evit时候肯定都是优先选择第二种情况，因为是正无穷大</p>
<ul>
<li>如果有多个无穷大，则按照FIFO的顺序evit<br>比如访问顺序如下（从左到右依次访问），假设k=3<br><code>1 2 3 4 1 2 3 1 2</code><br>这里无限大的数有3和4，按照FIFO顺序，3第一次出现的时间点和4还早，所以第一次evit时候选择3</li>
</ul>
</li>
<li>第二种情况没有了的话，则按照第一种情况，这里直接看哪个数倒数第k次最早出现就好了，那么就是Backward k-distance最大的</li>
</ul>
<h1 id="SetEvictable"><a href="#SetEvictable" class="headerlink" title="SetEvictable"></a>SetEvictable</h1><p>需要注意的是某个数是evitable才能被evit，也就是`这个函数的作用，因为此时某个数据正在被访问，不能evit</p>
<p>有一种情况是SetEvictable时候，但是这个数还没有被访问过或者是被evit了，那么这个函数直接return就好了</p>
<h1 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h1><p>我是使用了两个顺序容器和一个map</p>
<ul>
<li><p>map记录了某个数第n次访问的index，比如hist(1, 3)，代表1这个数第3次访问的index</p>
</li>
<li><p>当某个数还没有访问k次时候，就放到第一个容器，保证容器内的顺序是FIFO的，这样每次从队首或者队尾出队就好了，因为某些数可能不是Evictable的，实际上需要遍历一下容器，找到第一个能够Evictable的。</p>
</li>
<li><p>如果达到k次，那么把这个数从第一个容器挪到第二个容器</p>
</li>
<li><p>evit时候，如果第一个容器已经是empty的，那么代表没有正无穷的数，需要从第二个容器拿，此时因为map记录了每次容器出现的时间点，按照map对容器排序后直接取好了。这里没有想到一个方法类似第一个容器那么维护状态，考虑一下访问顺序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 1 1 2 2 2 1 X</span><br></pre></td></tr></table></figure>
<p>虽然1是最后evit的，但是按照Backward 3-distance来看，1才是要evit，不能每次访问就更新那个数在第二个容器的位置。</p>
<p>看了下discord的讨论，有比这个更快的方法，应该使用了堆之类的容器维护</p>
</li>
</ul>
<hr>
<p>维护某个数是否已经出现，以及其状态：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">LruEntry</span> &#123;</span><br><span class="line">    <span class="type">bool</span> evictable_&#123;<span class="literal">false</span>&#125;;</span><br><span class="line">    <span class="type">size_t</span> access_count_&#123;<span class="number">0</span>&#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">std::unordered_map&lt;<span class="type">frame_id_t</span>, LruEntry&gt; lru_entry_hash_;</span><br></pre></td></tr></table></figure>
<p>第一个容器：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::list&lt;<span class="type">frame_id_t</span>&gt; less_than_k_frames_;</span><br></pre></td></tr></table></figure>
<p>第二个容器：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">frame_id_t</span>&gt; more_than_k_frames_;</span><br></pre></td></tr></table></figure>
<p>记录每个数每次出现的时间点：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PairHash</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">auto</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> std::pair&lt;<span class="type">frame_id_t</span>, <span class="type">size_t</span>&gt; &amp;p)</span> <span class="type">const</span> -&gt; std::<span class="type">size_t</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 使用 std::hash 计算哈希值</span></span><br><span class="line">      std::<span class="type">size_t</span> h1 = std::hash&lt;<span class="type">frame_id_t</span>&gt;&#123;&#125;(p.first);</span><br><span class="line">      std::<span class="type">size_t</span> h2 = std::hash&lt;<span class="type">size_t</span>&gt;&#123;&#125;(p.second);</span><br><span class="line">      <span class="keyword">return</span> h1 ^ (h2 &lt;&lt; <span class="number">1</span>);  <span class="comment">// 可以使用异或和位移等运算来组合哈希值</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">std::unordered_map&lt;std::pair&lt;<span class="type">frame_id_t</span>, <span class="type">size_t</span>&gt;, <span class="type">size_t</span>, PairHash&gt; hist_;</span><br></pre></td></tr></table></figure>
<p>获取某个数第k次出现的时间：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">GetLastKAccessTime</span><span class="params">(<span class="type">const</span> <span class="type">frame_id_t</span> x)</span> <span class="type">const</span> -&gt; <span class="type">size_t</span> </span>&#123;</span><br><span class="line">	<span class="type">const</span> <span class="keyword">auto</span> last_k = lru_entry_hash_.<span class="built_in">at</span>(x).access_count_ - k_ + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> hist_.<span class="built_in">at</span>(std::<span class="built_in">make_pair</span>(x, last_k));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>按照Backward k-distance对第二个容器排序：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::<span class="built_in">sort</span>(more_than_k_frames_.<span class="built_in">begin</span>(), more_than_k_frames_.<span class="built_in">end</span>(),</span><br><span class="line">            [&amp;](<span class="type">frame_id_t</span> a, <span class="type">frame_id_t</span> b) &#123; <span class="keyword">return</span> <span class="built_in">GetLastKAccessTime</span>(a) &lt; <span class="built_in">GetLastKAccessTime</span>(b); &#125;);</span><br></pre></td></tr></table></figure></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://greenhathg.github.io">GreenHatHg</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://greenhathg.github.io/2023/06/06/CMU445-Project1-LRU-K%E6%80%BB%E7%BB%93/">https://greenhathg.github.io/2023/06/06/CMU445-Project1-LRU-K%E6%80%BB%E7%BB%93/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://greenhathg.github.io" target="_blank">GreenHatHGのBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cmu445/">cmu445</a><a class="post-meta__tags" href="/tags/lru/">lru</a></div><div class="post-share"><div class="social-share" data-image="https://images.unsplash.com/photo-1619342802099-027bc73e30eb?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1171&amp;q=80" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2023/07/01/CMU445-Project1-BufferPoolManagerInstance%E6%80%BB%E7%BB%93/" title="CMU445-Project1-BufferPoolManagerInstance总结"><img class="cover" src="https://images.unsplash.com/photo-1618170673668-0eea9c66d40c?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1171&amp;q=80" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">CMU445-Project1-BufferPoolManagerInstance总结</div></div><div class="info-2"><div class="info-item-1">Buffer PoolDisk-Oriented DBMS什么是buffer pool，buffer pool有什么用（针对Disk-Oriented DBMS）   The database is all on disk, and the data in the database files is organized into pages.  In order to operate on the data the DBMS needs to bring the data into memory. It does this by having a buffer pool that manages the movement back and forth between disk and memory.  The DBMS also have an execution engine that will execute queries.  The execution engine will ask the buffer pool for a specific page, and...</div></div></div></a><a class="pagination-related" href="/2023/04/24/CMU445-Project1-ExtendibleHashTable%E6%80%BB%E7%BB%93/" title="CMU445-Project1-ExtendibleHashTable总结"><img class="cover" src="https://images.unsplash.com/photo-1619075120066-02024cb853bd?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1171&amp;q=80" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">CMU445-Project1-ExtendibleHashTable总结</div></div><div class="info-2"><div class="info-item-1">前提：搞懂https://www.geeksforgeeks.org/extendible-hashing-dynamic-approach-to-dbms/ Whyhttps://15445.courses.cs.cmu.edu/fall2022/project1/ 待补充，可看原论文设计要点：  Page Fault Access Memory/Disk Dynamic File Organization Balance Radix Search Tree Static &amp; Dynamic Hash  Concepts $h$: fixed hash function $K$: is a key $K’$: $h(K)$, also $pseudokey$.  We choose pseudokeys to be of fixed length, such as 32 bits.  The pseudokeys are of fixed length, the keys need not be.   $I(K)$: is associated...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2023/02/15/CMU445-Project0-primer/" title="CMU445-Project0-primer"><img class="cover" src="https://images.unsplash.com/photo-1620880762272-c2bf6b4f1ce2?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1171&q=80" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-06-15</div><div class="info-item-2">CMU445-Project0-primer</div></div><div class="info-2"><div class="info-item-1">背景 链接：https://15445.courses.cs.cmu.edu/fall2022/project0/ 目的：因为后续的项目都是使用c++编写，所以提供一个入门c++项目给新手熟悉下。 要求：给出基本的代码框架，填充核心代码实现trie树的插入、查找、删除。最终要求为并发版本，但是不要求性能，所以可以一把大锁直接梭哈。 环境：使用clang-12，c++17标准 使用到的常见cpp知识点： unique_ptr管理内存资源 类的常见知识，比如构造函数，类方法等 rvalue与move shared_mutex    trie树简单记录下trie树 作用又称前缀树或字典树，存储公共前缀字符串比较高效，一般用于字符串查找。 在项目中的应用是将(key, value)插入到trie树，类似hashmap的作用，但是使用trie树实现。 普通的trie树如下：  项目中要求实现的trie树：  上面是将(ab, 1)和(ac,...</div></div></div></a><a class="pagination-related" href="/2023/07/01/CMU445-Project1-BufferPoolManagerInstance%E6%80%BB%E7%BB%93/" title="CMU445-Project1-BufferPoolManagerInstance总结"><img class="cover" src="https://images.unsplash.com/photo-1618170673668-0eea9c66d40c?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1171&q=80" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-06-15</div><div class="info-item-2">CMU445-Project1-BufferPoolManagerInstance总结</div></div><div class="info-2"><div class="info-item-1">Buffer PoolDisk-Oriented DBMS什么是buffer pool，buffer pool有什么用（针对Disk-Oriented DBMS）   The database is all on disk, and the data in the database files is organized into pages.  In order to operate on the data the DBMS needs to bring the data into memory. It does this by having a buffer pool that manages the movement back and forth between disk and memory.  The DBMS also have an execution engine that will execute queries.  The execution engine will ask the buffer pool for a specific page, and...</div></div></div></a><a class="pagination-related" href="/2023/04/24/CMU445-Project1-ExtendibleHashTable%E6%80%BB%E7%BB%93/" title="CMU445-Project1-ExtendibleHashTable总结"><img class="cover" src="https://images.unsplash.com/photo-1619075120066-02024cb853bd?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1171&q=80" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-06-15</div><div class="info-item-2">CMU445-Project1-ExtendibleHashTable总结</div></div><div class="info-2"><div class="info-item-1">前提：搞懂https://www.geeksforgeeks.org/extendible-hashing-dynamic-approach-to-dbms/ Whyhttps://15445.courses.cs.cmu.edu/fall2022/project1/ 待补充，可看原论文设计要点：  Page Fault Access Memory/Disk Dynamic File Organization Balance Radix Search Tree Static &amp; Dynamic Hash  Concepts $h$: fixed hash function $K$: is a key $K’$: $h(K)$, also $pseudokey$.  We choose pseudokeys to be of fixed length, such as 32 bits.  The pseudokeys are of fixed length, the keys need not be.   $I(K)$: is associated...</div></div></div></a><a class="pagination-related" href="/2024/01/05/CMU445-Project2-BPlusTree-Delete-Single-Threaded/" title="CMU445-Project2-BPlusTree-Delete-Single-threaded"><img class="cover" src="https://images.unsplash.com/photo-1620880762296-f9787c134352?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=1171&q=80" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-06-15</div><div class="info-item-2">CMU445-Project2-BPlusTree-Delete-Single-threaded</div></div><div class="info-2"><div class="info-item-1">单线程版 B+树删除操作 Delete在删除时用到两个重要的属性是，也就是node最多有多少个search-key value，最少有多少个，根据这个可以决定采用什么措施去维持整个树的平衡  Each leaf can hold up to n−1 search-key values. We allow leaf nodes to contain as few as ⌈(n−1)/2⌉ search-key values. Each nonleaf node in the tree (other than the root) has between ⌈n/2⌉ and n children.  下面举例课本中的删除过程，粗略了解一下删除的过程： 已经有一棵B+树如下，从leaf node可知N=4 所以leaf node最多放3个search-key value，最少2个search-key value；nonleaf node最多4个children，最少2个children。   Coalesce一开始要删除Srini这个Index，首先查找到Srini位于哪个leaf...</div></div></div></a><a class="pagination-related" href="/2023/12/12/CMU445-Project2-BPlusTree-Insert/" title="CMU445-Project1-BPlusTree-Insert-Single-threaded"><img class="cover" src="https://images.unsplash.com/photo-1621761836815-6e43911fbcfc?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1171&q=80" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-06-15</div><div class="info-item-2">CMU445-Project1-BPlusTree-Insert-Single-threaded</div></div><div class="info-2"><div class="info-item-1">单线程版 B+树插入操作 Overview Index: The index in database system is responsible for fast data retrieval without having to search through every row in a database table, providing the basis for both rapid random lookups (快速随机查找) and efficient access of ordered records. B+Tree dynamic index structure:  It is a balanced tree in which the internal pages direct the search and leaf pages contains actual data entries.B+ Tree properties   Each node except root can have a maximum of M children and at least...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://avatars0.githubusercontent.com/u/34258355?s=460&amp;u=eb0a1ce09dd045532464cb42f020e8ba1d025b6c&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">GreenHatHg</div><div class="author-info-description">巴拉巴拉能量! rm -rf / --no-preserve-root</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">201</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">239</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/GreenHatHG"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/GreenHatHG" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:greenhat2333@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#LRU-K"><span class="toc-number">1.</span> <span class="toc-text">LRU-K</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Backward-k-distance"><span class="toc-number">2.</span> <span class="toc-text">Backward k-distance</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Evit"><span class="toc-number">3.</span> <span class="toc-text">Evit</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SetEvictable"><span class="toc-number">4.</span> <span class="toc-text">SetEvictable</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Implementation"><span class="toc-number">5.</span> <span class="toc-text">Implementation</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/06/15/Xueqiu_OKaSiJiZhangShiFu-summary-2025-06-15-04-30-24/" title="[Xueqiu_OKaSiJiZhangShiFu] 发言时段总结 - 2025-06-15 04:30"><img src="https://images.unsplash.com/photo-1619342802099-027bc73e30eb?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1171&amp;q=80" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[Xueqiu_OKaSiJiZhangShiFu] 发言时段总结 - 2025-06-15 04:30"/></a><div class="content"><a class="title" href="/2025/06/15/Xueqiu_OKaSiJiZhangShiFu-summary-2025-06-15-04-30-24/" title="[Xueqiu_OKaSiJiZhangShiFu] 发言时段总结 - 2025-06-15 04:30">[Xueqiu_OKaSiJiZhangShiFu] 发言时段总结 - 2025-06-15 04:30</a><time datetime="2025-06-15T04:30:24.000Z" title="发表于 2025-06-15 04:30:24">2025-06-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/15/Xueqiu_ShanXing-summary-2025-06-15-04-30-24/" title="[Xueqiu_ShanXing] 发言时段总结 - 2025-06-15 04:30"><img src="https://images.unsplash.com/photo-1620880762296-f9787c134352?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=1171&amp;q=80" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[Xueqiu_ShanXing] 发言时段总结 - 2025-06-15 04:30"/></a><div class="content"><a class="title" href="/2025/06/15/Xueqiu_ShanXing-summary-2025-06-15-04-30-24/" title="[Xueqiu_ShanXing] 发言时段总结 - 2025-06-15 04:30">[Xueqiu_ShanXing] 发言时段总结 - 2025-06-15 04:30</a><time datetime="2025-06-15T04:30:24.000Z" title="发表于 2025-06-15 04:30:24">2025-06-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/15/Xueqiu_RZ95-summary-2025-06-15-04-30-21/" title="[Xueqiu_RZ95] 发言时段总结 - 2025-06-15 04:30"><img src="https://images.unsplash.com/photo-1618170673668-0eea9c66d40c?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1171&amp;q=80" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[Xueqiu_RZ95] 发言时段总结 - 2025-06-15 04:30"/></a><div class="content"><a class="title" href="/2025/06/15/Xueqiu_RZ95-summary-2025-06-15-04-30-21/" title="[Xueqiu_RZ95] 发言时段总结 - 2025-06-15 04:30">[Xueqiu_RZ95] 发言时段总结 - 2025-06-15 04:30</a><time datetime="2025-06-15T04:30:21.000Z" title="发表于 2025-06-15 04:30:21">2025-06-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/14/Xueqiu_Forever-summary-2025-06-14-19-19-38/" title="[Xueqiu_Forever] 发言时段总结 - 2025-06-14 19:19"><img src="https://images.unsplash.com/photo-1621761836815-6e43911fbcfc?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1171&amp;q=80" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[Xueqiu_Forever] 发言时段总结 - 2025-06-14 19:19"/></a><div class="content"><a class="title" href="/2025/06/14/Xueqiu_Forever-summary-2025-06-14-19-19-38/" title="[Xueqiu_Forever] 发言时段总结 - 2025-06-14 19:19">[Xueqiu_Forever] 发言时段总结 - 2025-06-14 19:19</a><time datetime="2025-06-14T19:19:38.000Z" title="发表于 2025-06-14 19:19:38">2025-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/14/Xueqiu_Forever-summary-2025-06-14/" title="[Xueqiu_Forever] 发言时段总结 - 2025-06-14"><img src="https://images.unsplash.com/photo-1619075120066-02024cb853bd?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1171&amp;q=80" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[Xueqiu_Forever] 发言时段总结 - 2025-06-14"/></a><div class="content"><a class="title" href="/2025/06/14/Xueqiu_Forever-summary-2025-06-14/" title="[Xueqiu_Forever] 发言时段总结 - 2025-06-14">[Xueqiu_Forever] 发言时段总结 - 2025-06-14</a><time datetime="2025-06-14T09:16:50.000Z" title="发表于 2025-06-14 09:16:50">2025-06-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2025 By GreenHatHg</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://blog-twikoo-khaki.vercel.app',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://blog-twikoo-khaki.vercel.app',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    GLOBAL_CONFIG_SITE.pageType === 'post' && getCount()

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>